<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Workshop Pro</title>
    <link rel="manifest" href="manifest.json">

    <!-- Libraries -->
    <script src="https://cdn.jsdelivr.net/npm/pouchdb@8.0.1/dist/pouchdb.min.js"></script>
    <script src="https://unpkg.com/html5-qrcode"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <!-- Fonts & Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <div class="background-blob"></div>

    <!-- Top Navigation -->
    <nav class="top-nav">
        <h2 onclick="goToDashboard()">Workshop<span>Pro</span></h2>
        <button id="sync-btn" onclick="handleSync()">
            <i class="fas fa-cloud-upload-alt"></i> Sync
        </button>
    </nav>

    <div id="sync-status">
        <i class="fas fa-circle" style="color: #fbbf24; font-size: 8px;"></i>
        <span id="sync-status-text">Offline Mode</span>
    </div>

    <!-- Main Menu Screen -->
    <div id="main-menu" class="screen active">
        <div class="menu-grid">
            <div class="menu-box" onclick="showScreen('inventory-screen')">
                <div class="icon">ðŸ“¦</div>
                <span>Add Stock</span>
            </div>
            <div class="menu-box" onclick="showScreen('quick-bill-screen')">
                <div class="icon">ðŸ§¾</div>
                <span>Quick Bill</span>
            </div>
            <div class="menu-box" onclick="showScreen('stock-list-screen')">
                <div class="icon">ðŸ“Š</div>
                <span>Reports</span>
            </div>
            <div class="menu-box" onclick="showScreen('ledger-screen')">
                <div class="icon">ðŸ“‹</div>
                <span>Ledger</span>
            </div>
            <div class="menu-box" onclick="showScreen('customers-screen')">
                <div class="icon">ðŸ‘¥</div>
                <span>Customers</span>
            </div>
            <div class="menu-box" onclick="showScreen('dashboard-screen')">
                <div class="icon">ðŸ“ˆ</div>
                <span>Dashboard</span>
            </div>
        </div>
    </div>

    <!-- Dashboard Screen -->
    <div id="dashboard-screen" class="screen">
        <button class="back-menu-btn" onclick="goToDashboard()">
            <i class="fas fa-arrow-left"></i> Back to Menu
        </button>

        <div class="glass-card">
            <h3>Dashboard Overview</h3>
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-label">Total Items</div>
                    <div class="stat-value" id="dash-total-items">0</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Total Sales</div>
                    <div class="stat-value" id="dash-total-sales">â‚¹0</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Customers</div>
                    <div class="stat-value" id="dash-total-customers">0</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Low Stock</div>
                    <div class="stat-value" id="dash-low-stock">0</div>
                </div>
            </div>
        </div>

        <div class="glass-card">
            <h4>Recent Transactions</h4>
            <div id="dash-recent" class="recent-list"></div>
        </div>
    </div>

    <!-- Inventory Screen (Add Stock) -->
    <div id="inventory-screen" class="screen">
        <button class="back-menu-btn" onclick="goToDashboard()">
            <i class="fas fa-arrow-left"></i> Back to Menu
        </button>

        <section class="glass-card">
            <div class="scanner-container">
                <div id="reader"></div>
                <div class="scanner-overlay" id="scanner-overlay-inventory" style="display: none;">
                    <div class="scanner-line"></div>
                </div>
                <div class="flash-icon" id="flash-inventory" style="display: none;" onclick="toggleFlash('inventory')">
                    <i class="fas fa-bolt"></i>
                </div>
                <div class="scanner-controls">
                    <button class="cam-btn-active" onclick="toggleScanner('inventory')">
                        <i class="fas fa-camera"></i> Start Camera
                    </button>
                    <label class="file-label">
                        <i class="fas fa-file-image"></i> Scan Image
                        <input type="file" id="inv-file-input" accept="image/*" style="display:none"
                            onchange="scanFile(this, 'inventory')">
                    </label>
                </div>
            </div>
        </section>

        <section class="glass-card">
            <div class="form-group">
                <label><i class="fas fa-barcode"></i> Barcode ID</label>
                <input type="text" id="part-id" placeholder="Enter or scan barcode">
            </div>

            <div class="form-group">
                <label><i class="fas fa-tag"></i> Part Name</label>
                <input type="text" id="part-name" placeholder="Enter part name">
            </div>

            <div class="form-row">
                <div class="form-group half">
                    <label><i class="fas fa-rupee-sign"></i> Price (â‚¹)</label>
                    <input type="number" id="part-price" placeholder="0.00" step="0.01" min="0">
                </div>

                <div class="form-group half">
                    <label><i class="fas fa-cubes"></i> Quantity</label>
                    <div class="stepper-container">
                        <button type="button" class="step-btn" onclick="changeQty('part-qty', -1)">âˆ’</button>
                        <input type="number" id="part-qty" value="1" min="1">
                        <button type="button" class="step-btn" onclick="changeQty('part-qty', 1)">+</button>
                    </div>
                </div>
            </div>

            <div class="form-group">
                <label><i class="fas fa-layer-group"></i> Category</label>
                <select id="part-category">
                    <option value="general">General</option>
                    <option value="brake">Brake System</option>
                    <option value="engine">Engine</option>
                    <option value="electrical">Electrical</option>
                    <option value="body">Body Parts</option>
                </select>
            </div>

            <div class="form-row">
                <div class="form-group half">
                    <label><i class="fas fa-map-marker-alt"></i> Location</label>
                    <input type="text" id="part-location" placeholder="Shelf / Rack">
                </div>

                <div class="form-group half">
                    <label><i class="fas fa-exclamation-triangle"></i> Min Stock</label>
                    <input type="number" id="part-min-stock" value="5" min="0">
                </div>
            </div>

            <button onclick="savePart()" class="action-btn save">
                <i class="fas fa-save"></i> Save Stock
            </button>
        </section>
    </div>

    <!-- Quick Bill Screen -->
    <div id="quick-bill-screen" class="screen">
        <button class="back-menu-btn" onclick="goToDashboard()">
            <i class="fas fa-arrow-left"></i> Back to Menu
        </button>

        <section class="glass-card">
            <div class="scanner-container">
                <div id="bill-reader"></div>
                <div class="scanner-overlay" id="scanner-overlay-bill" style="display: none;">
                    <div class="scanner-line"></div>
                </div>
                <div class="flash-icon" id="flash-bill" style="display: none;" onclick="toggleFlash('bill')">
                    <i class="fas fa-bolt"></i>
                </div>
                <div class="scanner-controls">
                    <button class="cam-btn-active" onclick="toggleScanner('bill')">
                        <i class="fas fa-camera"></i> Start Camera
                    </button>
                    <label class="file-label">
                        <i class="fas fa-file-image"></i> Scan Image
                        <input type="file" id="bill-file-input" accept="image/*" style="display:none"
                            onchange="scanFile(this, 'bill')">
                    </label>
                </div>
            </div>
        </section>

        <section class="glass-card">
            <div class="form-group">
                <label><i class="fas fa-user"></i> Customer Name *</label>
                <input type="text" id="bill-cust-name" placeholder="Enter customer name" required>
            </div>

            <div class="form-group">
                <label><i class="fas fa-barcode"></i> Barcode</label>
                <input type="text" id="bill-item-id" placeholder="Scan barcode">
            </div>

            <div class="form-group">
                <label><i class="fas fa-box"></i> Item Name</label>
                <input type="text" id="bill-desc" placeholder="Item description">
            </div>

            <div class="form-row">
                <div class="form-group half">
                    <label><i class="fas fa-rupee-sign"></i> Price</label>
                    <input type="number" id="bill-price" placeholder="0.00" step="0.01">
                </div>
                <div class="form-group half">
                    <label><i class="fas fa-sort-amount-up"></i> Quantity</label>
                    <div class="stepper-container small">
                        <button type="button" class="step-btn" onclick="changeQty('bill-qty', -1)">âˆ’</button>
                        <input type="number" id="bill-qty" value="1" min="1">
                        <button type="button" class="step-btn" onclick="changeQty('bill-qty', 1)">+</button>
                    </div>
                </div>
            </div>

            <button onclick="addItemToCurrentBill()" class="action-btn add" style="width: 100%; margin-top: 15px;">
                <i class="fas fa-plus-circle"></i> Add to Bill
            </button>
        </section>

        <section id="current-items-section" class="glass-card" style="display:none;">
            <h4>Current Bill</h4>
            <div class="table-scroll">
                <table>
                    <thead>
                        <tr>
                            <th>Item</th>
                            <th>Qty</th>
                            <th>Price</th>
                            <th>Total</th>
                            <th></th>
                        </tr>
                    </thead>
                    <tbody id="current-bill-body"></tbody>
                </table>
            </div>

            <div class="bill-summary">
                <div class="summary-row">
                    <span>Subtotal:</span>
                    <span>â‚¹<span id="bill-subtotal">0</span></span>
                </div>
                <div class="summary-row">
                    <span>Discount:</span>
                    <span>
                        <input type="number" id="bill-discount" value="0" min="0" class="discount-input"
                            onchange="updateBillTotal()">
                    </span>
                </div>
                <div class="summary-row total">
                    <span>Total:</span>
                    <span>â‚¹<span id="bill-total">0</span></span>
                </div>
            </div>

            <div class="form-row">
                <div class="form-group half">
                    <label><i class="fas fa-credit-card"></i> Payment</label>
                    <select id="payment-method">
                        <option value="cash">Cash</option>
                        <option value="card">Card</option>
                        <option value="upi">UPI</option>
                        <option value="credit">Credit</option>
                    </select>
                </div>
                <div class="form-group half">
                    <label><i class="fas fa-money-bill"></i> Amount Paid</label>
                    <input type="number" id="amount-paid" placeholder="0.00" onkeyup="calculateBalance()">
                </div>
            </div>

            <div id="balance-due"></div>

            <button onclick="finalizeBill()" class="action-btn finalize">
                <i class="fas fa-check-circle"></i> Finalize Bill
            </button>

            <button onclick="clearBill()" class="action-btn secondary">
                <i class="fas fa-trash"></i> Clear Bill
            </button>
        </section>
    </div>

    <!-- Reports Screen (Stock List) -->
    <div id="stock-list-screen" class="screen">
        <button class="back-menu-btn" onclick="goToDashboard()">
            <i class="fas fa-arrow-left"></i> Back to Menu
        </button>

        <section class="glass-card">
            <div class="form-group">
                <label><i class="fas fa-search"></i> Search Items</label>
                <input type="text" id="stock-search" placeholder="Search by name or barcode..."
                    onkeyup="updateInventoryUI()">
            </div>

            <div class="form-group">
                <label><i class="fas fa-filter"></i> Filter</label>
                <select id="stock-filter" onchange="updateInventoryUI()">
                    <option value="all">All Items</option>
                    <option value="low">Low Stock</option>
                    <option value="out">Out of Stock</option>
                </select>
            </div>

            <div class="stats-grid small">
                <div class="stat-mini">
                    <span class="label">Total Value</span>
                    <span class="value" id="total-value">â‚¹0</span>
                </div>
                <div class="stat-mini">
                    <span class="label">Items</span>
                    <span class="value" id="total-items-count">0</span>
                </div>
            </div>

            <div class="table-scroll">
                <table class="inventory-table">
                    <thead>
                        <tr>
                            <th>Item</th>
                            <th>In</th>
                            <th>Left</th>
                            <th>Price</th>
                            <th>Action</th>
                        </tr>
                    </thead>
                    <tbody id="inventory-list-table"></tbody>
                </table>
            </div>

            <button onclick="exportInventory()" class="action-btn export">
                <i class="fas fa-download"></i> Export CSV
            </button>
        </section>
    </div>

    <!-- Ledger Screen -->
    <div id="ledger-screen" class="screen">
        <button class="back-menu-btn" onclick="goToDashboard()">
            <i class="fas fa-arrow-left"></i> Back to Menu
        </button>

        <section class="glass-card">
            <h4>Customer Balances</h4>
            <div id="customer-balances-list" class="balances-list"></div>

            <div class="stats-grid small">
                <div class="stat-mini">
                    <span class="label">Total Sales</span>
                    <span class="value" id="ledger-total">â‚¹0</span>
                </div>
                <div class="stat-mini">
                    <span class="label">Due Amount</span>
                    <span class="value" id="credit-due">â‚¹0</span>
                </div>
            </div>

            <h4 style="margin-top: 20px;">Transaction History</h4>
            <div id="bill-history-list" class="transaction-list"></div>

            <button onclick="exportLedger()" class="action-btn export">
                <i class="fas fa-download"></i> Export Ledger
            </button>
        </section>
    </div>

    <!-- Customers Screen -->
    <div id="customers-screen" class="screen">
        <button class="back-menu-btn" onclick="goToDashboard()">
            <i class="fas fa-arrow-left"></i> Back to Menu
        </button>

        <section class="glass-card">
            <div class="search-add-bar">
                <div class="form-group" style="flex: 1;">
                    <label><i class="fas fa-search"></i> Search Customers</label>
                    <input type="text" id="customer-search" placeholder="Search by name..."
                        onkeyup="updateCustomersUI()">
                </div>
                <button onclick="showAddCustomerModal()" class="add-btn">
                    <i class="fas fa-plus"></i> Add
                </button>
            </div>

            <div id="customers-list" class="customers-grid"></div>
        </section>
    </div>

    <!-- Add Customer Modal -->
    <div id="customer-modal" class="modal">
        <div class="modal-content glass-card">
            <h3><i class="fas fa-user-plus"></i> Add Customer</h3>

            <div class="form-group">
                <label><i class="fas fa-user"></i> Customer Name *</label>
                <input type="text" id="cust-name" placeholder="Enter full name">
            </div>

            <div class="form-group">
                <label><i class="fas fa-phone"></i> Phone Number</label>
                <input type="text" id="cust-phone" placeholder="Enter phone number">
            </div>

            <div class="form-group">
                <label><i class="fas fa-envelope"></i> Email</label>
                <input type="email" id="cust-email" placeholder="Enter email">
            </div>

            <div class="form-group">
                <label><i class="fas fa-map-marker-alt"></i> Address</label>
                <input type="text" id="cust-address" placeholder="Enter address">
            </div>

            <div class="form-group">
                <label><i class="fas fa-id-card"></i> GST Number</label>
                <input type="text" id="cust-gst" placeholder="Enter GST (optional)">
            </div>

            <div class="modal-actions">
                <button onclick="saveCustomer()" class="action-btn save">Save Customer</button>
                <button onclick="closeCustomerModal()" class="action-btn cancel">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Bill Preview Modal -->
    <div id="bill-preview-modal" class="modal">
        <div class="modal-content glass-card">
            <div class="modal-header">
                <h3><i class="fas fa-file-invoice"></i> Bill Preview</h3>
                <button onclick="closeModal()" class="close-btn"><i class="fas fa-times"></i></button>
            </div>
            <div class="modal-body" id="bill-preview-content"></div>
            <div class="modal-actions">
                <button onclick="printBill()" class="action-btn print">
                    <i class="fas fa-print"></i> Print
                </button>
                <button onclick="closeModal()" class="action-btn cancel">Close</button>
            </div>
        </div>
    </div>

    <!-- Floating Action Button (only visible on dashboard) -->
    <button class="fab" id="fab-button" onclick="toggleQuickMenu()">
        <i class="fas fa-plus"></i>
    </button>

    <!-- Quick Actions Menu -->
    <div id="quick-actions-menu" class="quick-actions-menu glass-card">
        <button onclick="showScreen('quick-bill-screen'); toggleQuickMenu()">
            <i class="fas fa-receipt"></i> New Bill
        </button>
        <button onclick="showScreen('inventory-screen'); toggleQuickMenu()">
            <i class="fas fa-box"></i> Add Stock
        </button>
        <button onclick="showAddCustomerModal(); toggleQuickMenu()">
            <i class="fas fa-user-plus"></i> Add Customer
        </button>
        <button onclick="handleSync(); toggleQuickMenu()">
            <i class="fas fa-cloud-upload-alt"></i> Sync Now
        </button>
    </div>

    <!-- Toast Container -->
    <div id="toast-container" class="toast-container"></div>

    <!-- Custom JavaScript -->
    <script src="app.js"></script>
</body>

</html>