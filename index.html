<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Workshop Pro</title>
    <link rel="manifest" href="manifest.json">

    <!-- Libraries -->
    <script src="https://cdn.jsdelivr.net/npm/pouchdb@8.0.1/dist/pouchdb.min.js"></script>
    <script src="https://unpkg.com/html5-qrcode"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <!-- Fonts & Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <div class="background-blob"></div>

    <!-- Top Navigation -->
    <nav class="top-nav">
        <h2 onclick="goToDashboard()">Workshop<span>Pro</span></h2>
        <button id="sync-btn" onclick="handleSync()">
            <i class="fas fa-cloud-upload-alt"></i> Sync
        </button>
    </nav>
    <div id="sync-status">Status: Offline</div>

    <!-- Main Menu Screen -->
    <div id="main-menu" class="screen active">
        <div class="menu-grid">
            <div class="menu-box" onclick="showScreen('inventory-screen')">
                <div class="icon">ðŸ“¦</div>
                <span>Add Stock</span>
            </div>
            <div class="menu-box" onclick="showScreen('quick-bill-screen')">
                <div class="icon">ðŸ§¾</div>
                <span>Quick Bill</span>
            </div>
            <div class="menu-box" onclick="showScreen('stock-list-screen')">
                <div class="icon">ðŸ“Š</div>
                <span>Reports</span>
            </div>
            <div class="menu-box" onclick="showScreen('ledger-screen')">
                <div class="icon">ðŸ“‹</div>
                <span>Ledger</span>
            </div>
            <div class="menu-box" onclick="showScreen('customers-screen')">
                <div class="icon">ðŸ‘¥</div>
                <span>Customers</span>
            </div>
            <div class="menu-box" onclick="showScreen('dashboard-screen')">
                <div class="icon">ðŸ“ˆ</div>
                <span>Dashboard</span>
            </div>
        </div>
    </div>

    <!-- Dashboard Screen -->
    <div id="dashboard-screen" class="screen">
        <button class="back-menu-btn" onclick="goToDashboard()">
            <i class="fas fa-arrow-left"></i> Back to Menu
        </button>

        <div class="glass-card">
            <h3>Dashboard Overview</h3>
            <div class="stats-grid">
                <div class="stat-card">
                    <div>Total Items</div>
                    <div class="stat-value" id="dash-total-items">0</div>
                </div>
                <div class="stat-card">
                    <div>Total Sales</div>
                    <div class="stat-value" id="dash-total-sales">â‚¹0</div>
                </div>
                <div class="stat-card">
                    <div>Customers</div>
                    <div class="stat-value" id="dash-total-customers">0</div>
                </div>
                <div class="stat-card">
                    <div>Low Stock</div>
                    <div class="stat-value" id="dash-low-stock">0</div>
                </div>
            </div>
        </div>

        <div class="glass-card">
            <h4>Recent Transactions</h4>
            <div id="dash-recent" style="margin-top: 10px;"></div>
        </div>
    </div>

    <!-- Inventory Screen (Add Stock) -->
    <div id="inventory-screen" class="screen">
        <button class="back-menu-btn" onclick="goToDashboard()">
            <i class="fas fa-arrow-left"></i> Back to Menu
        </button>

        <section class="glass-card">
            <div id="reader"></div>
            <div class="scanner-controls">
                <button class="cam-btn-active" onclick="toggleScanner('inventory')">
                    <i class="fas fa-camera"></i> Start Camera
                </button>
                <label class="file-label">
                    <i class="fas fa-file-image"></i> Scan Image File
                    <input type="file" id="inv-file-input" accept="image/*" style="display:none"
                        onchange="scanFile(this, 'inventory')">
                </label>
            </div>
        </section>

        <section class="glass-card">
            <input type="text" id="part-id" placeholder="Barcode ID">
            <input type="text" id="part-name" placeholder="Part Name">
            <input type="number" id="part-price" placeholder="Price (â‚¹)">

            <div class="stepper-container">
                <button type="button" class="step-btn" onclick="changeQty('part-qty', -1)">âˆ’</button>
                <input type="number" id="part-qty" value="1" min="1">
                <button type="button" class="step-btn" onclick="changeQty('part-qty', 1)">+</button>
            </div>

            <select id="part-category">
                <option value="general">General</option>
                <option value="brake">Brake System</option>
                <option value="engine">Engine</option>
                <option value="electrical">Electrical</option>
                <option value="body">Body Parts</option>
            </select>

            <input type="text" id="part-location" placeholder="Storage Location">
            <input type="number" id="part-min-stock" placeholder="Min Stock Alert" value="5">

            <button onclick="savePart()" class="action-btn save">
                <i class="fas fa-save"></i> Save Stock
            </button>
        </section>
    </div>

    <!-- Quick Bill Screen -->
    <div id="quick-bill-screen" class="screen">
        <button class="back-menu-btn" onclick="goToDashboard()">
            <i class="fas fa-arrow-left"></i> Back to Menu
        </button>

        <section class="glass-card">
            <div id="bill-reader"></div>
            <div class="scanner-controls">
                <button class="cam-btn-active" onclick="toggleScanner('bill')">
                    <i class="fas fa-camera"></i> Start Camera
                </button>
                <label class="file-label">
                    <i class="fas fa-file-image"></i> Scan Image File
                    <input type="file" id="bill-file-input" accept="image/*" style="display:none"
                        onchange="scanFile(this, 'bill')">
                </label>
            </div>
        </section>

        <section class="glass-card">
            <input type="text" id="bill-cust-name" placeholder="Customer Name" required>
            <input type="text" id="bill-item-id" placeholder="Scan Barcode ID">
            <input type="text" id="bill-desc" placeholder="Item Name">
            <input type="number" id="bill-price" placeholder="Price (â‚¹)">

            <div class="stepper-container">
                <button type="button" class="step-btn" onclick="changeQty('bill-qty', -1)">âˆ’</button>
                <input type="number" id="bill-qty" value="1" min="1">
                <button type="button" class="step-btn" onclick="changeQty('bill-qty', 1)">+</button>
            </div>

            <button onclick="addItemToCurrentBill()" class="action-btn add">
                <i class="fas fa-plus-circle"></i> Add to Bill
            </button>
        </section>

        <section id="current-items-section" class="glass-card">
            <h4>Current Bill</h4>
            <div class="table-scroll">
                <table>
                    <thead>
                        <tr>
                            <th>Item</th>
                            <th>Qty</th>
                            <th>Price</th>
                            <th>Total</th>
                            <th></th>
                        </tr>
                    </thead>
                    <tbody id="current-bill-body"></tbody>
                </table>
            </div>

            <div class="bill-summary">
                <div class="summary-row">
                    <span>Subtotal:</span>
                    <span>â‚¹<span id="bill-subtotal">0</span></span>
                </div>
                <div class="summary-row">
                    <span>Discount:</span>
                    <span>
                        <input type="number" id="bill-discount" value="0" min="0" style="width:80px; padding:5px;"
                            onchange="updateBillTotal()">
                    </span>
                </div>
                <div class="summary-row total">
                    <span>Total:</span>
                    <span>â‚¹<span id="bill-total">0</span></span>
                </div>
            </div>

            <select id="payment-method" style="margin-bottom: 10px;">
                <option value="cash">Cash</option>
                <option value="card">Card</option>
                <option value="upi">UPI</option>
                <option value="credit">Credit</option>
            </select>

            <input type="number" id="amount-paid" placeholder="Amount Paid" onkeyup="calculateBalance()">
            <div id="balance-due"></div>

            <button onclick="finalizeBill()" class="action-btn finalize">
                <i class="fas fa-check-circle"></i> Finalize Bill
            </button>

            <button onclick="clearBill()" class="action-btn" style="background:#64748b; margin-top:5px;">
                <i class="fas fa-trash"></i> Clear Bill
            </button>
        </section>
    </div>

    <!-- Reports Screen (Stock List) -->
    <div id="stock-list-screen" class="screen">
        <button class="back-menu-btn" onclick="goToDashboard()">
            <i class="fas fa-arrow-left"></i> Back to Menu
        </button>

        <section class="glass-card">
            <input type="text" id="stock-search" placeholder="ðŸ” Search items..." onkeyup="updateInventoryUI()">

            <select id="stock-filter" onchange="updateInventoryUI()" style="margin-bottom: 10px;">
                <option value="all">All Items</option>
                <option value="low">Low Stock</option>
                <option value="out">Out of Stock</option>
            </select>

            <div class="stats-grid" style="margin: 10px 0;">
                <div class="stat-card">
                    <div>Total Value</div>
                    <div class="stat-value" id="total-value">â‚¹0</div>
                </div>
                <div class="stat-card">
                    <div>Items</div>
                    <div class="stat-value" id="total-items-count">0</div>
                </div>
            </div>

            <div class="table-scroll">
                <table>
                    <thead>
                        <tr>
                            <th>Item</th>
                            <th>In</th>
                            <th>Left</th>
                            <th>Price</th>
                            <th>Action</th>
                        </tr>
                    </thead>
                    <tbody id="inventory-list-table"></tbody>
                </table>
            </div>

            <button onclick="exportInventory()" class="action-btn" style="background:#6366f1; margin-top:10px;">
                <i class="fas fa-download"></i> Export CSV
            </button>
        </section>
    </div>

    <!-- Ledger Screen -->
    <div id="ledger-screen" class="screen">
        <button class="back-menu-btn" onclick="goToDashboard()">
            <i class="fas fa-arrow-left"></i> Back to Menu
        </button>

        <section class="glass-card">
            <h4>Customer Balances</h4>
            <div id="customer-balances-list" style="margin: 10px 0;"></div>

            <div class="stats-grid">
                <div class="stat-card">
                    <div>Total Sales</div>
                    <div class="stat-value" id="ledger-total">â‚¹0</div>
                </div>
                <div class="stat-card">
                    <div>Due Amount</div>
                    <div class="stat-value" id="credit-due">â‚¹0</div>
                </div>
            </div>

            <h4 style="margin-top: 15px;">Transaction History</h4>
            <div id="bill-history-list"></div>

            <button onclick="exportLedger()" class="action-btn" style="background:#6366f1; margin-top:10px;">
                <i class="fas fa-download"></i> Export Ledger
            </button>
        </section>
    </div>

    <!-- Customers Screen -->
    <div id="customers-screen" class="screen">
        <button class="back-menu-btn" onclick="goToDashboard()">
            <i class="fas fa-arrow-left"></i> Back to Menu
        </button>

        <section class="glass-card">
            <div style="display: flex; gap: 10px; margin-bottom: 15px;">
                <input type="text" id="customer-search" placeholder="ðŸ” Search customers..." style="flex: 1;"
                    onkeyup="updateCustomersUI()">
                <button onclick="showAddCustomerModal()" class="action-btn"
                    style="width: auto; margin:0; padding:14px 20px;">
                    <i class="fas fa-plus"></i>
                </button>
            </div>

            <div id="customers-list" class="customers-grid"></div>
        </section>
    </div>

    <!-- Add Customer Modal -->
    <div id="customer-modal" class="modal">
        <div class="modal-content glass-card">
            <h3 style="margin-bottom: 15px;">Add Customer</h3>
            <input type="text" id="cust-name" placeholder="Customer Name *">
            <input type="text" id="cust-phone" placeholder="Phone Number">
            <input type="email" id="cust-email" placeholder="Email">
            <input type="text" id="cust-address" placeholder="Address">
            <input type="text" id="cust-gst" placeholder="GST Number">

            <div style="display: flex; gap: 10px; margin-top: 15px;">
                <button onclick="saveCustomer()" class="action-btn save" style="margin:0;">Save</button>
                <button onclick="closeCustomerModal()" class="action-btn"
                    style="background:#64748b; margin:0;">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Bill Preview Modal -->
    <div id="bill-preview-modal" class="modal">
        <div class="modal-content glass-card">
            <div style="max-height: 70vh; overflow-y: auto;" id="bill-preview-content"></div>
            <div style="display: flex; gap: 10px; margin-top: 15px;">
                <button onclick="printBill()" class="action-btn" style="background:#6366f1; margin:0;">Print</button>
                <button onclick="closeModal()" class="action-btn" style="background:#64748b; margin:0;">Close</button>
            </div>
        </div>
    </div>

    <!-- Floating Action Button -->
    <button class="fab" onclick="toggleQuickMenu()">
        <i class="fas fa-plus"></i>
    </button>

    <!-- Quick Actions Menu -->
    <div id="quick-actions-menu" class="quick-actions-menu glass-card">
        <button onclick="showScreen('quick-bill-screen'); toggleQuickMenu()">
            <i class="fas fa-receipt"></i> New Bill
        </button>
        <button onclick="showScreen('inventory-screen'); toggleQuickMenu()">
            <i class="fas fa-box"></i> Add Stock
        </button>
        <button onclick="showAddCustomerModal(); toggleQuickMenu()">
            <i class="fas fa-user-plus"></i> Add Customer
        </button>
        <button onclick="handleSync(); toggleQuickMenu()">
            <i class="fas fa-cloud-upload-alt"></i> Sync Now
        </button>
    </div>

    <!-- Toast Container -->
    <div id="toast-container" class="toast-container"></div>

    <!-- Custom JavaScript -->
    <script src="app.js"></script>
</body>

</html>