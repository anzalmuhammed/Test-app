<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Workshop Manager Pro</title>
    <script src="https://cdn.jsdelivr.net/npm/pouchdb@8.0.1/dist/pouchdb.min.js"></script>
    <script src="https://unpkg.com/html5-qrcode"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://accounts.google.com/gsi/client" async defer></script>
    <script src="https://apis.google.com/js/api.js"></script>
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <nav>
        <h2 onclick="clearAndBack()" style="cursor:pointer">Workshop App</h2>
        <button id="sync-btn" onclick="handleSync()">Cloud Sync</button>
    </nav>
    <p id="sync-status">Local Mode</p>

    <div class="container">
        <div id="main-menu" class="screen">
            <div class="menu-grid">
                <div class="menu-box" onclick="showScreen('inventory-screen')">
                    <div class="icon">üì¶</div>
                    <span>Add Products</span>
                </div>
                <div class="menu-box" onclick="showScreen('quick-bill-screen')">
                    <div class="icon">üßæ</div>
                    <span>Quick Bill</span>
                </div>
                <div class="menu-box" onclick="showScreen('stock-list-screen')">
                    <div class="icon">üìä</div>
                    <span>Stock Report</span>
                </div>
                <div class="menu-box" onclick="showScreen('ledger-screen')">
                    <div class="icon">üìã</div>
                    <span>Ledger</span>
                </div>
            </div>
        </div>

        <div id="inventory-screen" class="screen" style="display:none">
            <button class="back-menu-btn" onclick="clearAndBack()">‚Üê Back</button>
            <section>
                <div id="reader"></div>
                <div class="scanner-controls">
                    <button id="start-scan-manual" class="stop-btn" onclick="startScanner()">Start Camera</button>
                    <button id="restart-scan" class="stop-btn" onclick="startScanner()" style="display:none;">Scan
                        Another</button>
                    <label for="file-input" class="file-label">Scan an Image File</label>
                    <input type="file" id="file-input" accept="image/*" onchange="scanImageFile(event)"
                        style="display:none;">
                </div>
            </section>
            <section>
                <h3>Stock Management</h3>
                <input type="text" id="part-id" placeholder="Barcode ID">
                <input type="text" id="part-name" placeholder="Part Name">
                <input type="number" id="part-price" placeholder="Price (‚Çπ)">
                <label style="font-weight:bold; display:block; margin-top:10px;">Quantity:</label>
                <div class="stepper-container">
                    <button type="button" class="step-btn" onclick="changeQty('part-qty', -1)">‚àí</button>
                    <input type="number" id="part-qty" value="1">
                    <button type="button" class="step-btn" onclick="changeQty('part-qty', 1)">+</button>
                </div>
                <button onclick="savePart()" class="save-btn">Update Stock</button>
            </section>
        </div>

        <div id="quick-bill-screen" class="screen" style="display:none">
            <button class="back-menu-btn" onclick="clearAndBack()">‚Üê Back</button>
            <section>
                <div id="bill-reader"></div>
                <div class="scanner-controls">
                    <button id="bill-start-scan" class="stop-btn" onclick="startBillScanner()">Start Camera</button>
                    <button id="bill-restart-scan" class="stop-btn" onclick="startBillScanner()"
                        style="display:none;">Scan Next Item</button>
                    <label for="bill-file-input" class="file-label">Scan an Image File</label>
                    <input type="file" id="bill-file-input" accept="image/*" onchange="scanBillImageFile(event)"
                        style="display:none;">
                </div>
            </section>
            <section>
                <h3>Create Invoice</h3>
                <input type="text" id="bill-cust-name" placeholder="Customer Name">
                <hr>
                <input type="text" id="bill-item-id" placeholder="Barcode ID">
                <input type="text" id="bill-desc" placeholder="Item/Service Name">
                <input type="number" id="bill-price" placeholder="Price (‚Çπ)">
                <label style="font-weight:bold; display:block; margin-top:10px;">Quantity:</label>
                <div class="stepper-container">
                    <button type="button" class="step-btn" onclick="changeQty('bill-qty', -1)">‚àí</button>
                    <input type="number" id="bill-qty" value="1">
                    <button type="button" class="step-btn" onclick="changeQty('bill-qty', 1)">+</button>
                </div>
                <button onclick="addItemToCurrentBill()" class="save-btn" style="background:#6366f1; margin-top:10px;">+
                    Add to Bill</button>
            </section>
            <section id="current-items-section" style="display:none;">
                <h4>Current Items:</h4>
                <table>
                    <thead>
                        <tr>
                            <th>Item</th>
                            <th>Qty</th>
                            <th>Total</th>
                            <th></th>
                        </tr>
                    </thead>
                    <tbody id="current-bill-body"></tbody>
                </table>
                <p style="text-align:right; font-weight:bold; font-size:1.2em;">Total: ‚Çπ<span
                        id="bill-total-display">0.00</span></p>
                <button onclick="finalizeBill()" class="pay-btn">Finalize & Download PDF</button>
            </section>
        </div>

        <div id="stock-list-screen" class="screen" style="display:none">
            <button class="back-menu-btn" onclick="showScreen('main-menu')">‚Üê Back</button>
            <section style="overflow-x: auto;">
                <h3>Stock Inventory</h3>
                <input type="text" id="stock-search" placeholder="Search products..." onkeyup="updateInventoryUI()">
                <table>
                    <thead>
                        <tr>
                            <th>Item</th>
                            <th>In</th>
                            <th>Sold</th>
                            <th>Left</th>
                        </tr>
                    </thead>
                    <tbody id="inventory-list-table"></tbody>
                </table>
            </section>
        </div>

        <div id="ledger-screen" class="screen" style="display:none">
            <button class="back-menu-btn" onclick="showScreen('main-menu')">‚Üê Back</button>
            <section>
                <h3>Bill History (Sales Details)</h3>
                <input type="text" id="history-search" placeholder="Search customer or item..."
                    onkeyup="updateLedgerUI()">
                <div id="bill-history-list" style="margin-top:10px;"></div>
            </section>
            <section>
                <h3>Customer Balances</h3>
                <div id="customer-list"></div>
            </section>
        </div>
    </div>
    <script src="app.js"></script>
</body>

</html>