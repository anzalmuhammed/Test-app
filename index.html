<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Workshop Pro</title>
    <link rel="manifest" href="manifest.json">
    <script src="https://cdn.jsdelivr.net/npm/pouchdb@8.0.1/dist/pouchdb.min.js"></script>
    <script src="https://unpkg.com/html5-qrcode"></script>
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
</head>
<body>
    <div class="background-blob"></div>
    <nav class="top-nav">
        <h2 onclick="clearAndBack()">Workshop<span>Pro</span></h2>
        <button id="sync-btn" onclick="handleSync()">Login/Sync</button>
    </nav>
    <div id="sync-status">Status: Offline</div>

    <div class="container">
        <div id="main-menu" class="screen">
            <div class="menu-grid">
                <div class="menu-box" onclick="showScreen('inventory-screen')">
                    <div class="icon">üì¶</div><span>Add Stock</span>
                </div>
                <div class="menu-box" onclick="showScreen('quick-bill-screen')">
                    <div class="icon">üßæ</div><span>Quick Bill</span>
                </div>
                <div class="menu-box" onclick="showScreen('stock-list-screen')">
                    <div class="icon">üìä</div><span>Reports</span>
                </div>
                <div class="menu-box" onclick="showScreen('ledger-screen')">
                    <div class="icon">üìã</div><span>Ledger</span>
                </div>
            </div>
        </div>

        <div id="inventory-screen" class="screen" style="display:none">
            <button class="back-menu-btn" onclick="clearAndBack()">‚Üê Back</button>
            <section class="glass-card">
                <div id="reader"></div>
                <div class="scanner-controls">
                    <button id="inv-cam-btn" class="cam-btn-active" onclick="toggleScanner('inventory')">Start Camera</button>
                    <label class="file-label" for="inv-file-input">Scan an image file</label>
                    <input type="file" id="inv-file-input" accept="image/*" style="display:none" onchange="scanFile(this, 'inventory')">
                </div>
            </section>
            <section class="glass-card">
                <input type="text" id="part-id" placeholder="Barcode ID">
                <input type="text" id="part-name" placeholder="Part Name">
                <input type="number" id="part-price" placeholder="Price (‚Çπ)">
                <div class="stepper-container">
                    <button type="button" class="step-btn" onclick="changeQty('part-qty', -1)">‚àí</button>
                    <input type="number" id="part-qty" value="1">
                    <button type="button" class="step-btn" onclick="changeQty('part-qty', 1)">+</button>
                </div>
                <button onclick="savePart()" class="action-btn save">Save Stock</button>
            </section>
        </div>

        <div id="quick-bill-screen" class="screen" style="display:none">
            <button class="back-menu-btn" onclick="clearAndBack()">‚Üê Back</button>
            <section class="glass-card">
                <div id="bill-reader"></div>
                <div class="scanner-controls">
                    <button id="bill-cam-btn" class="cam-btn-active" onclick="toggleScanner('bill')">Start Camera</button>
                    <label class="file-label" for="bill-file-input">Scan an image file</label>
                    <input type="file" id="bill-file-input" accept="image/*" style="display:none" onchange="scanFile(this, 'bill')">
                </div>
            </section>
            <section class="glass-card">
                <input type="text" id="bill-cust-name" placeholder="Customer Name">
                <input type="text" id="bill-item-id" placeholder="Barcode ID">
                <input type="text" id="bill-desc" placeholder="Item Name">
                <input type="number" id="bill-price" placeholder="Price (‚Çπ)">
                <div class="stepper-container">
                    <button type="button" class="step-btn" onclick="changeQty('bill-qty', -1)">‚àí</button>
                    <input type="number" id="bill-qty" value="1">
                    <button type="button" class="step-btn" onclick="changeQty('bill-qty', 1)">+</button>
                </div>
                <button onclick="addItemToCurrentBill()" class="action-btn add">+ Add to List</button>
            </section>
            <section id="current-items-section" class="glass-card" style="display:none;">
                <table style="width:100%"><tbody id="current-bill-body"></tbody></table>
                <div style="text-align:right; font-weight:bold; margin:10px 0;">Total: ‚Çπ<span id="bill-total-display">0</span></div>
                <button onclick="finalizeBill()" class="action-btn finalize">Finalize Bill</button>
            </section>
        </div>

        <div id="stock-list-screen" class="screen" style="display:none">
            <button class="back-menu-btn" onclick="clearAndBack()">‚Üê Back</button>
            <section class="glass-card">
                <input type="text" id="stock-search" placeholder="Search..." onkeyup="updateInventoryUI()">
                <div class="table-scroll">
                    <table><thead><tr><th>Item</th><th>In</th><th>Left</th><th>Del</th></tr></thead><tbody id="inventory-list-table"></tbody></table>
                </div>
            </section>
        </div>

        <div id="ledger-screen" class="screen" style="display:none">
            <button class="back-menu-btn" onclick="clearAndBack()">‚Üê Back</button>
            <section class="glass-card">
                <div id="bill-history-list"></div>
            </section>
        </div>
    </div>
    <script src="app.js"></script>
</body>
</html>